@page
@model TradeControl.Web.Pages.Cash.CategoryTree.DeleteCashCodeModel
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Antiforgery
@{
    Layout = null;

    var key = (Request.Query["key"].Count > 0) ? Request.Query["key"].ToString()
                                             : (Request.HasFormContentType ? Request.Form["key"].ToString() : "");
    var code = Model.CashCode ?? (key?.StartsWith("code:") == true ? key.Substring("code:".Length) : key);
    var desc = Model.CashDescription ?? string.Empty;
    var category = Model.CategoryCode ?? string.Empty;
}

<div class="card">
    <div class="card-body">
        <h5 class="card-title text-danger">Delete Cash Code</h5>

        <div class="mb-3">
            <p class="mb-2">
                You are about to delete this Cash Code:
            </p>

            <dl class="row">
                <dt class="col-sm-3">Cash Code</dt>
                <dd class="col-sm-9"><code>@code</code></dd>

                <dt class="col-sm-3">Description</dt>
                <dd class="col-sm-9">@desc</dd>

                <dt class="col-sm-3">Category</dt>
                <dd class="col-sm-9"><code>@category</code></dd>
            </dl>

            <div class="alert alert-warning" role="alert">
                <strong>Warning:</strong> Deleting a Cash Code will be refused if related payments or transactions exist.
                Remove or reassign related payment/transaction rows before attempting to delete.
            </div>
        </div>

        <form id="deleteCashCodeForm" method="post" action="@Url.Page("/Cash/CategoryTree/Index", null, new { handler = "DeleteCashCode", key = key })">
            @Html.AntiForgeryToken()
            <input type="hidden" name="key" value="@key" />

            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="confirmDeleteCode" />
                <label class="form-check-label" for="confirmDeleteCode">I understand this will permanently delete the Cash Code (if no related payments exist)</label>
            </div>

            <div class="d-flex gap-2">
                <button id="btnDeleteCode" type="submit" class="btn btn-danger" disabled>Delete</button>
                <a class="btn btn-secondary" href="javascript:void(0)" data-embedded-cancel>Cancel</a>
            </div>
        </form>
    </div>
</div>

<script src="~/js/categoryTree.delete.js" asp-append-version="true"></script>
