@page
@model TradeControl.Web.Pages.Admin.Host.RotateKeysModel
@{ ViewData["Title"] = "Rotate Symmetric Keys"; }

<h1>@ViewData["Title"]</h1>

<div class="alert alert-warning">
    <h5>Important — Backup first</h5>
    <ul>
        <li>This operation rotates the AES key and IV used to encrypt secrets (mail host passwords).</li>
        <li>It will attempt to decrypt each host password with the current key and re-encrypt with the new key.</li>
        <li>If anything fails the affected password(s) will be left unchanged and an error will be logged.</li>
        <li>Make a full database backup before proceeding.</li>
    </ul>
</div>

<form method="post" class="mb-3">
    <div class="form-check mb-3">
        <input asp-for="ConfirmBackup" class="form-check-input" id="ConfirmBackup" />
        <label class="form-check-label" for="ConfirmBackup">I have backed up the database and understand the consequences</label>
        <span asp-validation-for="ConfirmBackup" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <button type="submit" class="btn btn-danger">Rotate Keys and Re-encrypt Host Passwords</button>
        <a asp-page="./Index" class="btn btn-outline-secondary ms-2">Cancel</a>
    </div>
</form>

@if (Model.ResultMessage != null)
{
    <div class="alert @(Model.Success ? "alert-success" : "alert-danger")" role="alert">
        @Model.ResultMessage
    </div>
}

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
