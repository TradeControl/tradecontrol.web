@page
@model TradeControl.Web.Pages.Admin.FileTransfer.DeleteModel

@{
    ViewData["Title"] = $"Delete from {Model.ContentType}";

    var embedded = false;
    if (Request?.Query.ContainsKey("embedded") == true)
    {
        embedded = string.Equals(Request.Query["embedded"], "1", StringComparison.OrdinalIgnoreCase)
            || string.Equals(Request.Query["embedded"], "true", StringComparison.OrdinalIgnoreCase);
    }

    var returnNode = (Request?.Query.ContainsKey("returnNode") == true)
        ? (Request.Query["returnNode"].ToString() ?? string.Empty)
        : string.Empty;

    var pageNumber = (Request?.Query.ContainsKey("pageNumber") == true)
        ? Request.Query["pageNumber"].ToString()
        : string.Empty;

    var pageSize = (Request?.Query.ContainsKey("pageSize") == true)
        ? Request.Query["pageSize"].ToString()
        : string.Empty;

    if (embedded)
    {
        Layout = "/Pages/Shared/_EmbeddedLayout.cshtml";
    }

    var backHref = embedded
        ? $"/Admin/FileTransfer/Index?embedded=1&contentType={Uri.EscapeDataString(Model.ContentType)}&returnNode={Uri.EscapeDataString(returnNode)}"
        : $"/Admin/FileTransfer/Index?contentType={Uri.EscapeDataString(Model.ContentType)}&returnNode={Uri.EscapeDataString(returnNode)}";

    if (!string.IsNullOrWhiteSpace(pageNumber))
        backHref += $"&pageNumber={Uri.EscapeDataString(pageNumber)}";

    if (!string.IsNullOrWhiteSpace(pageSize))
        backHref += $"&pageSize={Uri.EscapeDataString(pageSize)}";
}

<div class="container-fluid py-2">
    @if (!embedded)
    {
        <h1 class="h4 mb-3">@ViewData["Title"]</h1>
    }

    <div class="card shadow-sm mb-3">
        <div class="card-header bg-white">
            <div class="fw-semibold">Confirm delete</div>
        </div>
        <div class="card-body">
            <dl class="row mb-0">
                <dt class="col-sm-3">Name</dt>
                <dd class="col-sm-9">@Model.RemoveFile.Name</dd>
                <dt class="col-sm-3">Physical Path</dt>
                <dd class="col-sm-9 text-break">@Model.RemoveFile.PhysicalPath</dd>
                <dt class="col-sm-3">Size (bytes)</dt>
                <dd class="col-sm-9">@Model.RemoveFile.Length.ToString("N1")</dd>
            </dl>
        </div>
    </div>

    <form method="post" class="d-flex flex-wrap gap-2">
        <input type="hidden" asp-for="@Model.ContentType" />

        <input type="hidden" asp-for="RemoveFile.Name" />

        <input type="hidden" name="fileName" value="@Model.RemoveFile.Name" />

        @if (!string.IsNullOrWhiteSpace(pageNumber))
        {
            <input type="hidden" name="pageNumber" value="@pageNumber" />
        }

        @if (!string.IsNullOrWhiteSpace(pageSize))
        {
            <input type="hidden" name="pageSize" value="@pageSize" />
        }

        <input type="hidden" name="embedded" value="@(embedded ? "1" : "0")" />
        <input type="hidden" name="returnNode" value="@returnNode" />

        <button type="submit" class="btn btn-danger">Delete</button>
        <a href="@backHref" class="btn btn-outline-secondary">Cancel</a>
    </form>
</div>
